<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!--[if IE]>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <![endif]-->
	<title>PHP代码简洁之道---函数部分</title>
    <meta name="description" content="PHP代码简洁之道---函数部分" />
    <meta name="keywords" content="linux nginx apache mysql php 技术博客" />
    <!-- BOOTSTRAP CORE STYLE CSS -->
    <link href="/assets/css/bootstrap.css" rel="stylesheet" />
     <!-- FONTAWESOME STYLE CSS -->
     <link href="/assets/css/font-awesome.css" rel="stylesheet" />
    <!-- CUSTOM STYLE CSS -->
    <link href="/assets/css/style.css" rel="stylesheet" />
</head>
<body >
    <section class="header-section">
        <div class="container">
            <div class="row">
                <div class="col-md-2">
                    <img src="/assets/img/person.jpg" class="img-circle img-responsive" />
                </div>
                <div class="col-md-5 text-center">
                    <h1><strong>Jhon Alexan </strong></h1>
                    <h4>Blogger & Designer</h4>
                </div>
                <div class="col-md-5">
                    <h3>WHO M I :</h3>

                    I am a 26 years old guy who loves bloggging and designing .
                      I will provide all my works for free here with some good piece of information.
                     You can reach me at <i><strong>info@mydomain.com</strong></i>
                </div>
            </div>
        </div>
    </section>
    <!--HOME SECTION END-->

    <section>
        <div class="container">
            <div class="row">
                <div class="col-md-2 spon-txt">
                    <span>My Sponsers: </span>
                </div>
                <div class="col-md-10">
                    <img src="/assets/img/clients.png" alt="" class="img-rounded img-responsive" />
                </div>

            </div>
        </div>
    </section>
    <!--SPONSORS SECTION END-->
    <hr />
     <section  >
        <div class="container">
            <div class="row">
                <div class="col-md-9" >

                    <h4 id=">函数参数不要超过两个</h4>

<p><br></p>

<p>限制函数的参数数量是非常重要的，因为它使你的函数更容易测试。超过三个参数会导致参数之间的组合过多，你必须对每个单独的参数测试大量不同的情况。<br>
没有参数是最理想的情况，一个或两个参数是可以接受的，三个以上则是应该避免的。这很重要的。如果你有两个以上的参数，那么你的函数可能试图做的太多，如果不是，你可能需要将一个高级别的对象传当做参数传进去。<br>
<br></p>

<p>Bad:<br>
<code class="prettyprint"><br>
function createMenu($title, $body, $buttonText, $cancellable)<br>
{<br>
    // ...<br>
}<br>
</code><br>
Good：<br>
```<br>
class MenuConfig<br>
{<br>
    public $title;<br>
    public $body;<br>
    public $buttonText;<br>
    public $cancellable = false;<br>
}</p>

<p>$config = new MenuConfig();<br>
$config-&gt;title = &#39;Foo&#39;;<br>
$config-&gt;body = &#39;Bar&#39;;<br>
$config-&gt;buttonText = &#39;Baz&#39;;<br>
$config-&gt;cancellable = true;</p>

<p>function createMenu(MenuConfig $config)<br>
{<br>
    // ...<br>
}<br>
```<br>
<br></p>

<h4 id=">一个函数只做一件事</h4>

<p>这是软件工程中一个重要的原则。这会让你的代码清晰易懂以及易于复用。<br>
<br></p>

<p>Bad：<br>
<code class="prettyprint"><br>
function emailClients($clients)<br>
{<br>
    foreach ($clients as $client) {<br>
        $clientRecord = $db-&gt;find($client);<br>
        if ($clientRecord-&gt;isActive()) {<br>
            email($client);<br>
        }<br>
    }<br>
}<br>
</code><br>
Good:<br>
```<br>
function emailClients($clients)<br>
{<br>
    $activeClients = activeClients($clients);<br>
    array_walk($activeClients, &#39;email&#39;);<br>
}</p>

<p>function activeClients($clients)<br>
{<br>
    return array_filter($clients, &#39;isClientActive&#39;);<br>
}</p>

<p>function isClientActive($client)<br>
{<br>
    $clientRecord = $db-&gt;find($client);</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>return $clientRecord-&gt;isActive();
</code></pre></div>
<p>}<br>
```<br>
<br></p>

<h4 id=">函数名要能说明它是做什么的</h4>

<p>Bad:<br>
```<br>
class Email<br>
{<br>
    //...</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>public function handle()
{
    mail($this-&gt;to, $this-&gt;subject, $this-&gt;body);
}
</code></pre></div>
<p>}</p>

<p>$message = new Email(...);<br>
// 这是什么？一条消息的句柄？还是要写一个文件？（读者的疑问）<br>
$message-&gt;handle();<br>
<code class="prettyprint"><br>
Good:<br>
</code><br>
class Email <br>
{<br>
    //...</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>public function send()
{
    mail($this-&gt;to, $this-&gt;subject, $this-&gt;body);
}
</code></pre></div>
<p>}</p>

<p>$message = new Email(...);<br>
//  一目了然<br>
$message-&gt;send();<br>
```<br>
<br></p>

<h4 id=">函数应该只做一层抽象</h4>

<p>当你有多个层次的抽象时，你的函数就已经做的太多了。拆分这些函数，可以让代码可重用性更高且更易测试。<br>
Bad:<br>
```<br>
function parseBetterJSAlternative($code)<br>
{<br>
    $regexes = [<br>
        // ...<br>
    ];</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$statements = explode(&#39; &#39;, $code);
$tokens = [];
foreach ($regexes as $regex) {
    foreach ($statements as $statement) {
        // ...
    }
}

$ast = [];
foreach ($tokens as $token) {
    // lex...
}

foreach ($ast as $node) {
    // parse...
}
</code></pre></div>
<p>}<br>
<code class="prettyprint"><br>
Bad too:<br>
我们从函数中迁出去了一些工作，但是 parseBetterJSAlternative() 函数还是很复杂，不可测试。<br>
</code><br>
function tokenize($code)<br>
{<br>
    $regexes = [<br>
        // ...<br>
    ];</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$statements = explode(&#39; &#39;, $code);
$tokens = [];
foreach ($regexes as $regex) {
    foreach ($statements as $statement) {
        $tokens[] = /* ... */;
    }
}

return $tokens;
</code></pre></div>
<p>}</p>

<p>function lexer($tokens)<br>
{<br>
    $ast = [];<br>
    foreach ($tokens as $token) {<br>
        $ast[] = /* ... */;<br>
    }</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>return $ast;
</code></pre></div>
<p>}</p>

<p>function parseBetterJSAlternative($code)<br>
{<br>
    $tokens = tokenize($code);<br>
    $ast = lexer($tokens);<br>
    foreach ($ast as $node) {<br>
        // parse...<br>
    }<br>
}<br>
<code class="prettyprint"><br>
Good:<br>
最好的解决方案是移除 parseBetterJSAlternative 函数的依赖<br>
</code><br>
class Tokenizer<br>
{<br>
    public function tokenize($code)<br>
    {<br>
        $regexes = [<br>
            // ...<br>
        ];</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    $statements = explode(&#39; &#39;, $code);
    $tokens = [];
    foreach ($regexes as $regex) {
        foreach ($statements as $statement) {
            $tokens[] = /* ... */;
        }
    }

    return $tokens;
}
</code></pre></div>
<p>}</p>

<p>class Lexer<br>
{<br>
    public function lexify($tokens)<br>
    {<br>
        $ast = [];<br>
        foreach ($tokens as $token) {<br>
            $ast[] = /* ... */;<br>
        }</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>    return $ast;
}
</code></pre></div>
<p>}</p>

<p>class BetterJSAlternative<br>
{<br>
    private $tokenizer;<br>
    private $lexer;</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>public function __construct(Tokenizer $tokenizer, Lexer $lexer)
{
    $this-&gt;tokenizer = $tokenizer;
    $this-&gt;lexer = $lexer;
}

public function parse($code)
{
    $tokens = $this-&gt;tokenizer-&gt;tokenize($code);
    $ast = $this-&gt;lexer-&gt;lexify($tokens);
    foreach ($ast as $node) {
        // parse...
    }
}
</code></pre></div>
<p>}<br>
```<br>
<br></p>

<h4 id=">不要使用标志作为函数的参数</h4>

<p>当你在函数中使用标志来作为参数时，你的函数就不是只做一件事情了，这与我们前面所讲的每个函数只做一件事的原则相违背，所以不要使用标志作为函数的参数。<br>
Bad:<br>
<code class="prettyprint"><br>
function createFile($name, $temp = false)<br>
{<br>
    if ($temp) {<br>
        touch(&#39;./temp/&#39;.$name);<br>
    } else {<br>
        touch($name);<br>
    }<br>
}<br>
</code><br>
Good:<br>
```<br>
function createFile($name)<br>
{<br>
    touch($name);<br>
}</p>

<p>function createTempFile($name)<br>
{<br>
    touch(&#39;./temp/&#39;.$name);<br>
}<br>
```<br>
<br></p>

<h4 id=">避免副作用</h4>

<p>如果一个函数做了“拿到一个值并返回一个值或者多个值”以外的事情，那么这个函数就有可能产生副作用，副作用可能是意外的写入了文件、修改了全局变量、或者打钱给了陌生人。<br>
现在假如你确实要在函数中做一些有可能产生副作用的事情。 比如要写一个文件，你需要做的是将写文件的操作集中到一处，而不是在几个函数或者类里对同一个文件做操作，实现一个服务（函数或者类）去操作它，有且仅有一个。<br>
关键是要能避免常见的陷阱：像是在没有结构的对象之间共享状态、使用可能被写入任何值的可变数据类型、 不集中处理有可能产生副作用的操作。 如果你能做到这些，你会比绝大多数程序员更快乐。<br>
Bad:<br>
```<br>
// Global variable referenced by following function.<br>
// If we had another function that used this name, now it&#39;d be an array and it could break it.<br>
$name = &#39;Ryan McDermott&#39;;</p>

<p>function splitIntoFirstAndLastName()<br>
{<br>
    global $name;</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>$name = explode(&#39; &#39;, $name);
</code></pre></div>
<p>}</p>

<p>splitIntoFirstAndLastName();</p>

<p>var_dump($name); // [&#39;Ryan&#39;, &#39;McDermott&#39;];<br>
<code class="prettyprint"><br>
Good:<br>
</code><br>
function splitIntoFirstAndLastName($name)<br>
{<br>
    return explode(&#39; &#39;, $name);<br>
}</p>

<p>$name = &#39;Ryan McDermott&#39;;<br>
$newName = splitIntoFirstAndLastName($name);</p>

<p>var_dump($name); // &#39;Ryan McDermott&#39;;<br>
var_dump($newName); // [&#39;Ryan&#39;, &#39;McDermott&#39;];<br>
```<br>
<br></p>

<h4 id=">不要修改全局变量</h4>

<p>在许多编程语言中污染全局是一种糟糕的做法，因为你的库可能会与另一个库冲突，但是你的库的用户却一无所知，直到在生产环境中爆发异常。让我们来考虑一个例子：如果你想要拿到配置数组怎么办？你可以编写全局函数，如config()，但是它可能与另一个试图做同样事情的库冲突。<br>
Bad:<br>
<code class="prettyprint"><br>
function config()<br>
{<br>
    return  [<br>
        &#39;foo&#39; =&gt; &#39;bar&#39;,<br>
    ]<br>
}<br>
</code><br>
Good:<br>
```<br>
class Configuration<br>
{<br>
    private $configuration = [];</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>public function __construct(array $configuration)
{
    $this-&gt;configuration = $configuration;
}

public function get($key)
{
    return isset($this-&gt;configuration[$key]) ? $this-&gt;configuration[$key] : null;
}
</code></pre></div>
<p>}</p>

<p>$configuration = new Configuration([<br>
    &#39;foo&#39; =&gt; &#39;bar&#39;,<br>
]);<br>
```<br>
<br></p>

<h4 id=">避免条件判断</h4>

<p>人们会问“如果不用 if 语句我该怎么做？”，答案是在许多情况下，你可以用多态来实现同样的效果。那这样做什么好处，还是那句话：“一个函数应该只做一件事”， 当你的类或函数中有了 if 语句，你的函数就不止是只做一件事情了。<br>
Bad:<br>
```<br>
class Airplane<br>
{<br>
    // ...</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>public function getCruisingAltitude()
{
    switch ($this-&gt;type) {
        case &#39;777&#39;:
            return $this-&gt;getMaxAltitude() - $this-&gt;getPassengerCount();
        case &#39;Air Force One&#39;:
            return $this-&gt;getMaxAltitude();
        case &#39;Cessna&#39;:
            return $this-&gt;getMaxAltitude() - $this-&gt;getFuelExpenditure();
    }
}
</code></pre></div>
<p>}<br>
<code class="prettyprint"><br>
Good:<br>
</code><br>
interface Airplane<br>
{<br>
    // ...</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>public function getCruisingAltitude();
</code></pre></div>
<p>}</p>

<p>class Boeing777 implements Airplane<br>
{<br>
    // ...</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>public function getCruisingAltitude()
{
    return $this-&gt;getMaxAltitude() - $this-&gt;getPassengerCount();
}
</code></pre></div>
<p>}</p>

<p>class AirForceOne implements Airplane<br>
{<br>
    // ...</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>public function getCruisingAltitude()
{
    return $this-&gt;getMaxAltitude();
}
</code></pre></div>
<p>}</p>

<p>class Cessna implements Airplane<br>
{<br>
    // ...</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>public function getCruisingAltitude()
{
    return $this-&gt;getMaxAltitude() - $this-&gt;getFuelExpenditure();
}
</code></pre></div>
<p>}<br>
```<br>
<br></p>

<blockquote>
<p>转载 jeffrey_up<a href="https://segmentfault.com/a/1190000011432785">原文链接</a></p>
</blockquote>


                     <!--COMMENTS SECTION END-->
                </div>
        <div class="col-md-3">
    <ul class="list-group">
        <li class="list-group-item">
   <strong>Main Categories</strong>
  </li>
  <li class="list-group-item">
    <span class="badge">104</span>
    Technology 
  </li>
        <li class="list-group-item">
    <span class="badge">34</span>
    Blogging 
  </li>
        <li class="list-group-item">
    <span class="badge">10</span>
    Information 
  </li>
         <li class="list-group-item">
    <span class="badge">50</span>
    Security 
  </li>
         <li class="list-group-item">
   <strong>Other Categories</strong>
  </li>
  <li class="list-group-item">
    <span class="badge">104</span>
    Technology 
  </li>
        <li class="list-group-item">
    <span class="badge">34</span>
    Blogging 
  </li>
        <li class="list-group-item">
    <span class="badge">10</span>
    Information 
  </li>
         <li class="list-group-item">
    <span class="badge">50</span>
    Security 
  </li>
</ul>
                </div>
            </div>
</div>
    </section>
    <hr />
     <div class="container">
            <div class="row">
                <div class="col-md-12 text-center" style="padding:20px 5px;" >
                    <div id="copyright">
                        &copy 2017 Jhon Alexan | <a href="https://dongzhidong.github.io/" title="linux nginx apache mysql php 技术　博客">网站链接</a>
                    </div>
                    </div>
                </div>
                </div>
</body>
</html>
